<!-- new-order-form.component.html -->
<div class="new-order-container">
  <h2 mat-dialog-title>New Order for {{ data.customerName }}</h2>

  <form [formGroup]="orderForm" (ngSubmit)="onSubmit()">
    <div mat-dialog-content>
      <div class="form-section">
        <h3>Order Information</h3>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Employee</mat-label>
            <mat-select formControlName="empId">
              <mat-option *ngFor="let emp of employees" [value]="emp.empId">
                {{ emp.fullName }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="orderForm.get('empId')?.hasError('required')">
              Employee is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Shipper</mat-label>
            <mat-select formControlName="shipperId">
              <mat-option *ngFor="let shipper of shippers" [value]="shipper.shipperId">
                {{ shipper.companyName }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="orderForm.get('shipperId')?.hasError('required')">
              Shipper is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Ship Name</mat-label>
            <input matInput formControlName="shipName">
            <mat-error *ngIf="orderForm.get('shipName')?.hasError('required')">
              Ship name is required
            </mat-error>
          </mat-form-field>

          <!-- <mat-form-field appearance="outline">
            <mat-label>Ship Address</mat-label>
            <input matInput formControlName="shipAddress">
            <mat-error *ngIf="orderForm.get('shipAddress')?.hasError('required')">
              Ship address is required
            </mat-error>
          </mat-form-field> -->
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Ship Address</mat-label>
            <input matInput formControlName="shipAddress">
            <mat-error *ngIf="orderForm.get('shipAddress')?.hasError('required')">
              Ship address is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Ship City</mat-label>
            <input matInput formControlName="shipCity">
            <mat-error *ngIf="orderForm.get('shipCity')?.hasError('required')">
              Ship city is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Ship Country</mat-label>
            <input matInput formControlName="shipCountry">
            <mat-error *ngIf="orderForm.get('shipCountry')?.hasError('required')">
              Ship country is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Order Date</mat-label>
            <input matInput [matDatepicker]="orderDatePicker" formControlName="orderDate">
            <mat-datepicker-toggle matSuffix [for]="orderDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #orderDatePicker></mat-datepicker>
            <mat-error *ngIf="orderForm.get('orderDate')?.hasError('required')">
              Order date is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Required Date</mat-label>
            <input matInput [matDatepicker]="requiredDatePicker" formControlName="requiredDate">
            <mat-datepicker-toggle matSuffix [for]="requiredDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #requiredDatePicker></mat-datepicker>
            <mat-error *ngIf="orderForm.get('requiredDate')?.hasError('required')">
              Required date is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Shipped Date</mat-label>
            <input matInput [matDatepicker]="shippedDatePicker" formControlName="shippedDate">
            <mat-datepicker-toggle matSuffix [for]="shippedDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #shippedDatePicker></mat-datepicker>
          </mat-form-field>
        </div>

        <div class="form-row">
          <!-- <mat-form-field appearance="outline">
            <mat-label>Shipped Date</mat-label>
            <input matInput [matDatepicker]="shippedDatePicker" formControlName="shippedDate">
            <mat-datepicker-toggle matSuffix [for]="shippedDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #shippedDatePicker></mat-datepicker>
          </mat-form-field> -->

          <mat-form-field appearance="outline">
            <mat-label>Freight</mat-label>
            <input matInput type="number" formControlName="freight">
            <mat-error *ngIf="orderForm.get('freight')?.hasError('required')">
              Freight is required
            </mat-error>
            <mat-error *ngIf="orderForm.get('freight')?.hasError('min')">
              Freight must be greater than or equal to 0
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <div class="form-section">
        <h3>Order Details</h3>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Product</mat-label>
            <mat-select formControlName="productId">
              <mat-option *ngFor="let product of products" [value]="product.productId">
                {{ product.productName }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="orderForm.get('productId')?.hasError('required')">
              Product is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Unit Price</mat-label>
            <input matInput type="number" formControlName="unitPrice">
            <span matPrefix>$&nbsp;</span>
            <mat-error *ngIf="orderForm.get('unitPrice')?.hasError('required')">
              Unit price is required
            </mat-error>
            <mat-error *ngIf="orderForm.get('unitPrice')?.hasError('min')">
              Unit price must be greater than 0
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Quantity</mat-label>
            <input matInput type="number" formControlName="qty">
            <mat-error *ngIf="orderForm.get('qty')?.hasError('required')">
              Quantity is required
            </mat-error>
            <mat-error *ngIf="orderForm.get('qty')?.hasError('min')">
              Quantity must be at least 1
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Discount</mat-label>
            <input matInput type="number" formControlName="discount" step="0.01">
            <span matSuffix>%</span>
            <mat-error *ngIf="orderForm.get('discount')?.hasError('required')">
              Discount is required
            </mat-error>
            <mat-error *ngIf="orderForm.get('discount')?.hasError('min') || orderForm.get('discount')?.hasError('max')">
              Discount must be between 0 and 1
            </mat-error>
          </mat-form-field>
        </div>
      </div>
    </div>

    <div mat-dialog-actions class="actions">
      <button mat-button type="button" (click)="cancel()">Cancel</button>
      <button mat-raised-button color="primary" type="submit" [disabled]="orderForm.invalid || isSubmitting">
        <mat-spinner diameter="20" *ngIf="isSubmitting"></mat-spinner>
        <span *ngIf="!isSubmitting">Save Order</span>
      </button>
    </div>
  </form>
</div>
